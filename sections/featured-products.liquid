{% comment %} /sections/featured-products.liquid {% endcomment %}

{%- liquid
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading
  assign view_all_text = section.settings.view_all_text
  assign view_all_url = section.settings.view_all_url
  assign products_to_show = section.blocks.size
-%}

{%- if products_to_show > 0 -%}
  <div class="featured-products-section page-width">
    <div class="featured-products__header">
      <div class="featured-products__titles">
        {%- if heading != blank -%}
          <h2 class="featured-products__heading">{{ heading | escape }}</h2>
        {%- endif -%}
        {%- if subheading != blank -%}
          <p class="featured-products__subheading">{{ subheading | escape }}</p>
        {%- endif -%}
      </div>
      {%- if view_all_text != blank and view_all_url != blank -%}
        <a href="{{ view_all_url }}" class="featured-products__view-all link underlined-link">
          {{ view_all_text | escape }}
        </a>
      {%- endif -%}
    </div>

    {% comment %} Use the grid classes from base.css (flexbox based) {% endcomment %}
    {%- assign grid_classes = 'grid grid--4-col-desktop grid--2-col-tablet-down' -%}
    <div class="featured-products__grid {{ grid_classes }}">
      {%- for block in section.blocks -%}
        {%- assign product = block.settings.product -%}
        <div class="featured-products__card grid__item" {{ block.shopify_attributes }}>
          <div class="product-card">
            <a href="{{ product.url | default: '#' }}" class="product-card__link">
              <div class="product-card__image-wrapper">
                {%- if product.featured_media -%}
                  {%- assign image = product.featured_media.preview_image -%}
                  <img
                    srcset="
                      {%- if image.width >= 350 -%}{{ image | image_url: width: 350 }} 350w,{%- endif -%}
                      {%- if image.width >= 550 -%}{{ image | image_url: width: 550 }} 550w,{%- endif -%}
                      {%- if image.width >= 750 -%}{{ image | image_url: width: 750 }} 750w,{%- endif -%}
                      {%- if image.width >= 1100 -%}{{ image | image_url: width: 1100 }} 1100w,{%- endif -%}
                      {%- if image.width >= 1500 -%}{{ image | image_url: width: 1500 }} 1500w,{%- endif -%}
                      {{ image | image_url }} {{ image.width }}w
                    "
                    src="{{ image | image_url: width: 750 }}"
                    sizes="(min-width: 990px) calc(var(--page-width) / 4 - var(--grid-desktop-horizontal-spacing) * 3 / 4), (min-width: 750px) calc(100vw / 2 - var(--grid-desktop-horizontal-spacing) / 2 - 4rem), calc(100vw / 2 - var(--grid-mobile-horizontal-spacing) / 2 - 2rem)"
                    alt="{{ image.alt | escape }}"
                    loading="lazy"
                    width="{{ image.width }}"
                    height="{{ image.height }}"
                    class="product-card__image"
                  >
                {%- else -%}
                  {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg product-card__image' }}
                {%- endif -%}

                {%- assign saved_amount = product.compare_at_price | minus: product.price | money_without_trailing_zeros -%}
                {%- if product.compare_at_price > product.price -%}
                  <span class="product-card__badge">Save {{ saved_amount }}</span>
                {%- endif -%}
              </div>

              <div class="product-card__info">
                <h3 class="product-card__title">{{ product.title | default: 'Product Title' }}</h3>
                {% comment %} Placeholder for reviews/ratings {% endcomment %}
                <div class="product-card__reviews">
                  <span class="visually-hidden">Rating:</span>
                  <span>★★★★☆</span> <span class="product-card__review-count">(10) Reviews</span>
                </div>
                <div class="product-card__price">
                  <span class="price__regular {% if product.compare_at_price > product.price %}price--on-sale{% endif %}">
                    {{ product.price | money }}
                  </span>
                  {%- if product.compare_at_price > product.price -%}
                    <s class="price__compare-at">{{ product.compare_at_price | money }}</s>
                  {%- endif -%}
                </div>
              </div>
            </a>
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>
{%- endif -%}

{%- comment %} Basic Styles - Consider moving to a dedicated CSS file {%- endcomment %}
<style>
  .featured-products-section {
    padding-top: 3rem;
    padding-bottom: 3rem;
  }

  .featured-products__header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 2rem;
    flex-wrap: wrap; /* Allow wrapping on smaller screens */
    gap: 1rem; /* Add gap for wrapping */
  }

  .featured-products__titles {
    flex-grow: 1; /* Allow titles to take available space */
  }

  .featured-products__heading {
    margin-bottom: 0.5rem; /* Adjust spacing */
    font-size: 1.8rem; /* Example size */
    font-weight: bold;
    text-transform: uppercase;
    margin-top: 0;
    /* Assuming H2 style from base.css is sufficient */
  }

  .featured-products__subheading {
    margin-top: 0;
    margin-bottom: 0; /* Remove bottom margin */
    font-size: 1rem; /* Example size */
    color: rgba(var(--color-foreground), 0.75); /* Use existing theme variable/opacity */
  }

  .featured-products__view-all {
    white-space: nowrap; /* Prevent wrap */
    font-weight: bold;
    /* Use link styles from base.css */
  }

  .featured-products__grid {
    /* Inherit display: flex and gap from .grid in base.css */
    /* The column classes grid--4-col-desktop etc. are handled by base.css */
    margin: 0; /* Remove default grid margin if any */
    padding: 0; /* Remove default grid padding if any */
  }

  .featured-products__card.grid__item {
    /* Let base.css handle the width calculations */
    /* e.g., width: calc(25% - var(--grid-desktop-horizontal-spacing) * 3 / 4); */
    max-width: none; /* Override base.css potentially limiting max-width */
  }

  .product-card {
    text-align: left; /* Align text to the left */
    position: relative; /* Needed for badge positioning */
    height: 100%; /* Ensure card takes full height of grid item */
    display: flex; /* Allow inner content to flex */
    flex-direction: column;
  }

  .product-card__link {
    display: block;
    text-decoration: none;
    color: inherit;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .product-card__image-wrapper {
    position: relative;
    overflow: hidden;
    margin-bottom: 1rem; /* Space between image and info */
    aspect-ratio: 1 / 1.2; /* Adjust aspect ratio as needed */
    background-color: #f5f5f5; /* Placeholder background */
  }

  .product-card__image {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .product-card__badge {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background-color: #ffc107; /* Example gold color from image */
    color: #000;
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    font-weight: bold;
    border-radius: 3px;
    line-height: 1.2; /* Adjust line height */
  }

  .product-card__info {
    padding: 0 0.5rem; /* Add some padding if needed */
    margin-top: auto; /* Push info to bottom if image wrapper doesn't fill height */
  }

  .product-card__title {
    font-size: 1rem;
    margin-top: 0;
    margin-bottom: 0.5rem;
    font-weight: bold;
    /* Assume H3 style from base.css or adjust */
  }

  .product-card__reviews {
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .product-card__reviews span:first-child {
    /* Star rating color */
    color: #f0ad4e; /* Example gold color */
  }

  .product-card__review-count {
    color: rgba(var(--color-foreground), 0.75); /* Use existing theme variable/opacity */
    /* Use link styles from base.css if needed, remove underline if not desired */
    /* text-decoration: underline; */
  }

  .product-card__price {
    font-size: 1rem;
    font-weight: bold;
  }

  .price--on-sale {
    color: #d9534f; /* Fallback sale color (Bootstrap red) - Adjust if theme has a variable */
  }

  .price__compare-at {
    text-decoration: line-through;
    font-weight: normal;
    color: rgba(var(--color-foreground), 0.75); /* Use existing theme variable/opacity */
    margin-left: 0.5rem;
    font-size: 0.9em;
  }

  /* Remove redundant utility class definitions as they exist in base.css */
  /* .page-width { ... } */
  /* .grid { ... } */
  /* @media ... .grid { ... } */
  /* .link { ... } */
  /* .underlined-link { ... } */
  /* .visually-hidden { ... } */

  .placeholder-svg {
    width: 100%;
    height: 100%;
    display: block;
  }
</style>

{% schema %}
{
  "name": "Featured Products",
  "tag": "section",
  "class": "featured-products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop the Pro Selection"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Skate like the pros"
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "'View All' Link Text",
      "default": "View All"
    },
    {
      "type": "url",
      "id": "view_all_url",
      "label": "'View All' Link URL"
    }
  ],
  "blocks": [
    {
      "type": "product_card",
      "name": "Product Card",
      "limit": 4,
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Products",
      "blocks": [{ "type": "product_card" }, { "type": "product_card" }, { "type": "product_card" }, { "type": "product_card" }]
    }
  ]
}
{% endschema %}
