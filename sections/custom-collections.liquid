{% comment %} /sections/custom-collections.liquid {% endcomment %}

{{ 'section-custom-collections.css' | asset_url | stylesheet_tag }}
<script src="{{ 'custom-collections-slider.js' | asset_url }}" defer="defer"></script>

{%- liquid
  assign heading = section.settings.heading
  assign description = section.settings.description
  assign collections_to_show = section.blocks.size
-%}

{%- if collections_to_show > 0 -%}
  <div class="custom-collections-section page-width">
    <div class="custom-collections__header title-wrapper">
      {%- if heading != blank -%}
        <h2 class="custom-collections__heading title h2">{{ heading | escape }}</h2>
      {%- endif -%}
      {%- if description != blank -%}
        <div class="custom-collections__description rte">{{ description }}</div>
      {%- endif -%}
    </div>

    <div class="custom-collections__slider-outer">
      <div class="custom-collections__slider-container">
        <button type="button" class="custom-collections__slider-arrow custom-collections__slider-arrow--prev" aria-label="Previous collections">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
        </button>
        
        <div class="custom-collections__grid" id="collectionsSlider">
          {%- for block in section.blocks -%}
            {%- assign collection = block.settings.collection -%}
            {%- assign category_label = block.settings.category_label -%}
            {%- assign custom_title = block.settings.custom_title -%}
            {%- assign collection_title = custom_title | default: collection.title -%}
            {%- assign collection_image = collection.featured_image | default: collection.image -%}
            {%- assign button_text = block.settings.button_text | default: 'SHOP NOW' -%}

            <div class="custom-collections__card" {{ block.shopify_attributes }}>
              <div class="collection-card">
                <div class="collection-card__content">
                  {%- if category_label != blank -%}
                    <div class="collection-card__category">{{ category_label | escape }}</div>
                  {%- endif -%}
                  
                  <h3 class="collection-card__title">{{ collection_title }}</h3>
                </div>
                
                <div class="collection-card__image-wrapper">
                  {%- if collection_image != blank -%}
                    <img
                      srcset="
                        {%- if collection_image.width >= 360 -%}{{ collection_image | image_url: width: 360 }} 360w,{%- endif -%}
                        {%- if collection_image.width >= 533 -%}{{ collection_image | image_url: width: 533 }} 533w,{%- endif -%}
                        {%- if collection_image.width >= 720 -%}{{ collection_image | image_url: width: 720 }} 720w,{%- endif -%}
                        {%- if collection_image.width >= 1100 -%}{{ collection_image | image_url: width: 1100 }} 1100w,{%- endif -%}
                        {{ collection_image | image_url }} {{ collection_image.width }}w
                      "
                      src="{{ collection_image | image_url: width: 533 }}"
                      sizes="(min-width: 990px) calc((var(--page-width) - 60px) / 4), (min-width: 750px) calc((100vw - 30px) / 2), calc(100vw - 30px)"
                      alt="{{ collection_image.alt | escape }}"
                      loading="lazy"
                      width="{{ collection_image.width }}"
                      height="{{ collection_image.height }}"
                      class="collection-card__image"
                    >
                  {%- else -%}
                    {{ 'collection-1' | placeholder_svg_tag: 'placeholder-svg collection-card__image' }}
                  {%- endif -%}
                  
                  <a href="{{ collection.url | default: '#' }}" class="collection-card__button">
                    {{ button_text }}
                    <span class="collection-card__button-icon">
                      {{- 'icon-chevron-right.svg' | inline_asset_content -}}
                    </span>
                  </a>
                </div>
              </div>
            </div>
          {%- endfor -%}
        </div>
        
        <button type="button" class="custom-collections__slider-arrow custom-collections__slider-arrow--next" aria-label="Next collections">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
        </button>
      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Custom Collections",
  "tag": "section",
  "class": "custom-collections-section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Collections"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Explore our top-rated emergency kits, designed with your safety in mind. From comprehensive first aid solutions to specialized gear for any scenario, our products are trusted by professionals and adventurers alike. Be prepared for anything with MyMedic.</p>"
    }
  ],
  "blocks": [
    {
      "type": "collection_card",
      "name": "Collection Card",
      "limit": 4,
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "text",
          "id": "category_label",
          "label": "Category Label",
          "default": "ESSENTIAL KITS",
          "info": "Label that appears above the collection title"
        },
        {
          "type": "text",
          "id": "custom_title",
          "label": "Custom Title",
          "info": "Leave blank to use collection title"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text",
          "default": "SHOP NOW"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Collections",
      "blocks": [
        {
          "type": "collection_card",
          "settings": {
            "category_label": "ESSENTIAL KITS",
            "custom_title": "First Aid Kits"
          }
        },
        {
          "type": "collection_card",
          "settings": {
            "category_label": "COMMUNITY FAVORITES",
            "custom_title": "Medpacks"
          }
        },
        {
          "type": "collection_card",
          "settings": {
            "category_label": "SPECIALIZED SELECTIONS",
            "custom_title": "Refills"
          }
        },
        {
          "type": "collection_card",
          "settings": {
            "category_label": "TRUSTED GEAR",
            "custom_title": "Outlet"
          }
        }
      ]
    }
  ]
}
{% endschema %} 