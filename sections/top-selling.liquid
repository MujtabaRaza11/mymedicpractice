{%- liquid
  assign section_id = 'top-selling-' | append: section.id
  assign heading = section.settings.heading | default: 'TOP SELLING KITS'
  assign heading_color = section.settings.heading_color
  assign heading_font_size = section.settings.heading_font_size
  assign heading_font_size_mobile = section.settings.heading_font_size_mobile
  assign heading_font_weight = section.settings.heading_font_weight
  assign heading_margin_bottom = section.settings.heading_margin_bottom
  assign font_family = section.settings.font_family | default: "'Poppins', sans-serif"

  assign sale_badge_prefix = section.settings.sale_badge_prefix | default: 'SALE'
  assign sale_badge_bg_color = section.settings.sale_badge_bg_color
  assign sale_badge_text_color = section.settings.sale_badge_text_color
  
  assign new_badge_text = section.settings.new_badge_text | default: 'New'
  assign new_badge_bg_color = section.settings.new_badge_bg_color
  assign new_badge_text_color = section.settings.new_badge_text_color
  
  assign product_title_color = section.settings.product_title_color
  assign product_title_font_size = section.settings.product_title_font_size
  assign product_title_font_size_mobile = section.settings.product_title_font_size_mobile
  assign product_title_font_weight = section.settings.product_title_font_weight
  
  assign sale_price_color = section.settings.sale_price_color
  assign sale_price_bg_color = section.settings.sale_price_bg_color
  assign regular_price_color = section.settings.regular_price_color
  assign price_font_size = section.settings.price_font_size
  assign price_font_size_mobile = section.settings.price_font_size_mobile
  
  assign stock_text_color = section.settings.stock_text_color
  assign stock_font_size = section.settings.stock_font_size
  assign stock_font_size_mobile = section.settings.stock_font_size_mobile
  
  assign button_text = section.settings.button_text | default: 'SHOP NOW'
  assign button_text_color = section.settings.button_text_color
  assign button_border_color = section.settings.button_border_color
  assign button_font_size = section.settings.button_font_size
  assign button_font_size_mobile = section.settings.button_font_size_mobile
  
  assign card_gap = section.settings.card_gap
  assign card_background = section.settings.card_background
  assign card_padding = section.settings.card_padding
  assign card_border_radius = section.settings.card_border_radius
  
  assign section_padding = section.settings.section_padding
  assign section_background = section.settings.section_background
-%}

{{ 'section-top-selling.css' | asset_url | stylesheet_tag }}

<div class="top-selling-section" 
  id="{{ section_id }}"
  style="
    {% if section_padding %}--section-padding: {{ section_padding }}px;{% endif %}
    {% if section_background %}--section-background: {{ section_background }};{% endif %}
    {% if heading_color %}--heading-color: {{ heading_color }};{% endif %}
    {% if heading_font_size %}--heading-font-size: {{ heading_font_size }}px;{% endif %}
    {% if heading_font_size_mobile %}--heading-font-size-mobile: {{ heading_font_size_mobile }}px;{% endif %}
    {% if heading_font_weight %}--heading-font-weight: {{ heading_font_weight }};{% endif %}
    {% if heading_margin_bottom %}--heading-margin-bottom: {{ heading_margin_bottom }}px;{% endif %}
    --font-family: {{ font_family }};
    
    {% if sale_badge_bg_color %}--sale-badge-bg-color: {{ sale_badge_bg_color }};{% endif %}
    {% if sale_badge_text_color %}--sale-badge-text-color: {{ sale_badge_text_color }};{% endif %}
    {% if new_badge_bg_color %}--new-badge-bg-color: {{ new_badge_bg_color }};{% endif %}
    {% if new_badge_text_color %}--new-badge-text-color: {{ new_badge_text_color }};{% endif %}
    
    {% if product_title_color %}--product-title-color: {{ product_title_color }};{% endif %}
    {% if product_title_font_size %}--product-title-font-size: {{ product_title_font_size }}px;{% endif %}
    {% if product_title_font_size_mobile %}--product-title-font-size-mobile: {{ product_title_font_size_mobile }}px;{% endif %}
    {% if product_title_font_weight %}--product-title-font-weight: {{ product_title_font_weight }};{% endif %}
    
    {% if sale_price_color %}--sale-price-color: {{ sale_price_color }};{% endif %}
    {% if sale_price_bg_color %}--sale-price-bg-color: {{ sale_price_bg_color }};{% endif %}
    {% if regular_price_color %}--regular-price-color: {{ regular_price_color }};{% endif %}
    {% if price_font_size %}--price-font-size: {{ price_font_size }}px;{% endif %}
    {% if price_font_size_mobile %}--price-font-size-mobile: {{ price_font_size_mobile }}px;{% endif %}
    
    {% if stock_text_color %}--stock-text-color: {{ stock_text_color }};{% endif %}
    {% if stock_font_size %}--stock-font-size: {{ stock_font_size }}px;{% endif %}
    {% if stock_font_size_mobile %}--stock-font-size-mobile: {{ stock_font_size_mobile }}px;{% endif %}
    
    {% if button_text_color %}--button-text-color: {{ button_text_color }};{% endif %}
    {% if button_border_color %}--button-border-color: {{ button_border_color }};{% endif %}
    {% if button_font_size %}--button-font-size: {{ button_font_size }}px;{% endif %}
    {% if button_font_size_mobile %}--button-font-size-mobile: {{ button_font_size_mobile }}px;{% endif %}
    
    {% if card_gap %}--card-gap: {{ card_gap }}px;{% endif %}
    {% if card_background %}--card-background: {{ card_background }};{% endif %}
    {% if card_padding %}--card-padding: {{ card_padding }}px;{% endif %}
    {% if card_border_radius %}--card-border-radius: {{ card_border_radius }}px;{% endif %}
  "
>
  <div class="top-selling-container">
    <div class="top-selling-flex-wrapper">
      <div class="top-selling-heading-wrapper">
        <h2 class="top-selling-heading">{{ heading }}</h2>
      </div>
      
      <div class="top-selling-grid">
        {%- for block in section.blocks -%}
          {%- liquid
            assign product = all_products[block.settings.product]
            assign badge_type = block.settings.badge_type
            assign show_regular_price = block.settings.show_regular_price
            
            if product.featured_image != blank
              assign image_url = product.featured_image | img_url: '400x400', crop: 'center'
            endif
          -%}
          
          <div class="product-card" {{ block.shopify_attributes }}>
            <div class="product-image-container">
              {%- if badge_type == 'sale' -%}
                {%- if product.compare_at_price > product.price -%}
                  {% assign discount = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round %}
                  <div class="product-badge sale-badge">{{ sale_badge_prefix }} -{{ discount }}%</div>
                {%- else -%}
                  <div class="product-badge sale-badge">{{ sale_badge_prefix }}</div>
                {%- endif -%}
              {%- elsif badge_type == 'new' -%}
                <div class="product-badge new-badge">{{ new_badge_text }}</div>
              {%- endif -%}
              
              {%- if product.featured_image != blank -%}
                <img 
                  src="{{ image_url }}" 
                  alt="{{ product.title | escape }}" 
                  class="product-image"
                  width="200"
                  height="200"
                  loading="lazy"
                >
              {%- else -%}
                {{ 'product-1' | placeholder_svg_tag: 'product-image placeholder' }}
              {%- endif -%}
            </div>
            
            <div class="product-details">
              <h3 class="product-title">{{ product.title }}</h3>
              
              <div class="product-price">
                <span class="sale-price">${{ product.price | money_without_currency }}</span>
                
                {%- if product.compare_at_price > product.price and show_regular_price -%}
                  <span class="regular-price">${{ product.compare_at_price | money_without_currency }}</span>
                {%- endif -%}
              </div>
              
              <div class="product-stock">
                {%- if product.available -%}
                  <span class="in-stock">{{ product.inventory_quantity | default: 15 }} in stock</span>
                {%- else -%}
                  <span class="out-of-stock">Out of stock</span>
                {%- endif -%}
              </div>
              
              <a href="{{ product.url }}" class="shop-now-button">
                {{ button_text }} 
                <span class="arrow-icon">â€º</span>
              </a>
            </div>
          </div>
        {%- endfor -%}
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Top Selling Products",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "select",
      "id": "font_family",
      "label": "Font family",
      "options": [
        {
          "value": "'Poppins', sans-serif",
          "label": "Poppins"
        },
        {
          "value": "'Roboto', sans-serif",
          "label": "Roboto"
        },
        {
          "value": "'Open Sans', sans-serif",
          "label": "Open Sans"
        },
        {
          "value": "'Lato', sans-serif",
          "label": "Lato"
        },
        {
          "value": "'Montserrat', sans-serif",
          "label": "Montserrat"
        },
        {
          "value": "'Playfair Display', serif",
          "label": "Playfair Display"
        },
        {
          "value": "'Raleway', sans-serif",
          "label": "Raleway"
        },
        {
          "value": "system-ui, sans-serif",
          "label": "System Font"
        }
      ],
      "default": "'Poppins', sans-serif"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "TOP SELLING KITS"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#E21F26"
    },
    {
      "type": "range",
      "id": "heading_font_size",
      "min": 16,
      "max": 48,
      "step": 1,
      "unit": "px",
      "label": "Heading font size",
      "default": 28
    },
    {
      "type": "range",
      "id": "heading_font_size_mobile",
      "min": 14,
      "max": 36,
      "step": 1,
      "unit": "px",
      "label": "Mobile heading font size",
      "default": 20
    },
    {
      "type": "select",
      "id": "heading_font_weight",
      "label": "Heading font weight",
      "options": [
        {
          "value": "400",
          "label": "Regular"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semibold"
        },
        {
          "value": "700",
          "label": "Bold"
        },
        {
          "value": "800",
          "label": "Extra Bold"
        }
      ],
      "default": "700"
    },
    {
      "type": "range",
      "id": "heading_margin_bottom",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Heading bottom margin",
      "default": 20
    },
    {
      "type": "range",
      "id": "section_padding",
      "min": 0,
      "max": 60,
      "step": 4,
      "unit": "px",
      "label": "Section padding",
      "default": 24
    },
    {
      "type": "color",
      "id": "section_background",
      "label": "Section background",
      "default": "#FFFFFF"
    },
    {
      "type": "header",
      "content": "Product Card Settings"
    },
    {
      "type": "range",
      "id": "card_gap",
      "min": 8,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Gap between cards",
      "default": 20
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background color",
      "default": "#FFFFFF"
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Card padding",
      "default": 0
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Card corner radius",
      "default": 0
    },
    {
      "type": "header",
      "content": "Badge Settings"
    },
    {
      "type": "text",
      "id": "sale_badge_prefix",
      "label": "Sale badge prefix",
      "default": "SALE",
      "info": "Will be followed by the calculated discount, e.g. 'SALE -20%'"
    },
    {
      "type": "color",
      "id": "sale_badge_bg_color",
      "label": "Sale badge background",
      "default": "#E21F26"
    },
    {
      "type": "color",
      "id": "sale_badge_text_color",
      "label": "Sale badge text color",
      "default": "#FFFFFF"
    },
    {
      "type": "text",
      "id": "new_badge_text",
      "label": "New badge text",
      "default": "New"
    },
    {
      "type": "color",
      "id": "new_badge_bg_color",
      "label": "New badge background",
      "default": "#E21F26"
    },
    {
      "type": "color",
      "id": "new_badge_text_color",
      "label": "New badge text color",
      "default": "#FFFFFF"
    },
    {
      "type": "header",
      "content": "Product Details Settings"
    },
    {
      "type": "color",
      "id": "product_title_color",
      "label": "Product title color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "product_title_font_size",
      "min": 12,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Product title font size",
      "default": 16
    },
    {
      "type": "range",
      "id": "product_title_font_size_mobile",
      "min": 10,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Mobile product title font size",
      "default": 14
    },
    {
      "type": "select",
      "id": "product_title_font_weight",
      "label": "Product title font weight",
      "options": [
        {
          "value": "400",
          "label": "Regular"
        },
        {
          "value": "500",
          "label": "Medium"
        },
        {
          "value": "600",
          "label": "Semibold"
        },
        {
          "value": "700",
          "label": "Bold"
        }
      ],
      "default": "700"
    },
    {
      "type": "color",
      "id": "sale_price_color",
      "label": "Sale price color",
      "default": "#E21F26"
    },
    {
      "type": "color",
      "id": "sale_price_bg_color",
      "label": "Sale price background color",
      "default": "#E21F26"
    },
    {
      "type": "color",
      "id": "regular_price_color",
      "label": "Regular price color",
      "default": "#808080"
    },
    {
      "type": "range",
      "id": "price_font_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Price font size",
      "default": 16
    },
    {
      "type": "range",
      "id": "price_font_size_mobile",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Mobile price font size",
      "default": 14
    },
    {
      "type": "color",
      "id": "stock_text_color",
      "label": "Stock text color",
      "default": "#808080"
    },
    {
      "type": "range",
      "id": "stock_font_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Stock text font size",
      "default": 14
    },
    {
      "type": "range",
      "id": "stock_font_size_mobile",
      "min": 8,
      "max": 16,
      "step": 1,
      "unit": "px",
      "label": "Mobile stock text font size",
      "default": 12
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "SHOP NOW"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#E21F26"
    },
    {
      "type": "color",
      "id": "button_border_color",
      "label": "Button border color",
      "default": "#E21F26"
    },
    {
      "type": "range",
      "id": "button_font_size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "label": "Button font size",
      "default": 14
    },
    {
      "type": "range",
      "id": "button_font_size_mobile",
      "min": 8,
      "max": 16,
      "step": 1,
      "unit": "px",
      "label": "Mobile button font size",
      "default": 12
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "select",
          "id": "badge_type",
          "label": "Badge type",
          "options": [
            {
              "value": "none",
              "label": "No badge"
            },
            {
              "value": "sale",
              "label": "Sale badge"
            },
            {
              "value": "new",
              "label": "New badge"
            }
          ],
          "default": "none"
        },
        {
          "type": "checkbox",
          "id": "show_regular_price",
          "label": "Show regular price",
          "default": true
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Top Selling Products",
      "blocks": [
        {
          "type": "product",
          "settings": {
            "badge_type": "none"
          }
        },
        {
          "type": "product",
          "settings": {
            "badge_type": "sale"
          }
        },
        {
          "type": "product",
          "settings": {
            "badge_type": "new"
          }
        },
        {
          "type": "product",
          "settings": {
            "badge_type": "none"
          }
        }
      ]
    }
  ]
}
{% endschema %} 